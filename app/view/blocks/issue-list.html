
<form action="issues" method="get" id="filter">
	<table class="table table-striped table-hover table-responsive table-condensed issue-list">
		<thead>
			<input type="hidden" name="orderby" id="orderby" value="{{ !empty(@GET.orderby) ? @GET.orderby : 'priority' }}" />
			<input type="hidden" name="ascdesc" id="ascdesc" value="{{ !empty(@GET.ascdesc) ? @GET.ascdesc : 'desc' }}" />
			<check if="{{ !empty(@show_filters) }}">
				<tr class="issue-filters">
					<td colspan="2">
						<check if="{{ !empty(@show_export) }}">
							<a class="btn btn-default btn-xs" href="issues/export?{{ http_build_query($_GET) }}">
								<span class="glyphicon glyphicon-save"></span>&ensp;{{ @dict.export }}
							</a>
						</check>
					</td>
					<td>
						<input type="text" class="form-control input-sm" name="name" value="{{ !empty(@GET.name) ? @GET.name : '' }}">
					</td>
					<td>
						<select class="form-control input-sm" name="type_id">
							<option></option>
							<repeat group="{{ @types }}" value="{{ @item }}">
								<check if="{{ !empty(@GET.type_id) && @GET.type_id == @item.id }}">
									<true><option value="{{ @item.id }}" selected>{{ @item.name }}</option></true>
									<false><option value="{{ @item.id }}">{{ @item.name }}</option></false>
								</check>
							</repeat>
						</select>
					</td>
					<td>
						<select class="form-control input-sm" name="priority">
							<option></option>
							<repeat group="{{ @priorities }}" value="{{ @item }}">
								<check if="{{ !empty(@GET.priority) && @GET.priority == @item.value }}">
									<true><option value="{{ @item.value }}" selected>{{ @item.name }}</option></true>
									<false><option value="{{ @item.value }}">{{ @item.name }}</option></false>
								</check>
							</repeat>
						</select>
					</td>
					<td>
						<select class="form-control input-sm" name="status">
							<option></option>
							<optgroup label="{{ @dict.general }}">
								<check if="{{ !empty(@GET.status) && @GET.status == 'open' }}">
									<true><option value="open" selected>{{ @dict.open }}</option></true>
									<false><option value="open">{{ @dict.open }}</option></false>
								</check>
								<check if="{{ !empty(@GET.status) && @GET.status == 'closed' }}">
									<true><option value="closed" selected>{{ @dict.closed }}</option></true>
									<false><option value="closed">{{ @dict.closed }}</option></false>
								</check>
							</optgroup>
							<optgroup label="{{ @dict.exact_match }}">
								<repeat group="{{ @statuses }}" value="{{ @item }}">
									<check if="{{ !empty(@GET.status) && @GET.status == @item.id }}">
										<true><option value="{{ @item.id }}" selected>{{ @item.name }}</option></true>
										<false><option value="{{ @item.id }}">{{ @item.name }}</option></false>
									</check>
								</repeat>
							</optgroup>
						</select>
					</td>
					<td>
						<select class="form-control input-sm" name="author_id">
							<option></option>
							<option value="{{ @user.id }}">{{ @user.name }}</option>
							<optgroup label="{{ @dict.groups }}">
								<repeat group="{{ @groups }}" value="{{ @item }}">
									<check if="{{ !empty(@GET.author_id) && @GET.author_id == @item.id }}">
										<true><option value="{{ @item.id }}" selected>{{ @item.name }}</option></true>
										<false><option value="{{ @item.id }}">{{ @item.name }}</option></false>
									</check>
								</repeat>
							</optgroup>
							<optgroup label="{{ @dict.users }}">
								<repeat group="{{ @users }}" value="{{ @item }}">
									<check if="{{ !empty(@GET.author_id) && @GET.author_id == @item.id }}">
										<true><option value="{{ @item.id }}" selected>{{ @item.name }}</option></true>
										<false><option value="{{ @item.id }}">{{ @item.name }}</option></false>
									</check>
								</repeat>
							</optgroup>
						</select>
					</td>
					<td>
						<select class="form-control input-sm" name="owner_id">
							<option></option>
							<option value="{{ @user.id }}">{{ @user.name }}</option>
							<optgroup label="{{ @dict.groups }}">
								<repeat group="{{ @groups }}" value="{{ @item }}">
									<check if="{{ !empty(@GET.owner_id) && @GET.owner_id == @item.id }}">
										<true><option value="{{ @item.id }}" selected>{{ @item.name }}</option></true>
										<false><option value="{{ @item.id }}">{{ @item.name }}</option></false>
									</check>
								</repeat>
							</optgroup>
							<optgroup label="{{ @dict.users }}">
								<repeat group="{{ @users }}" value="{{ @item }}">
									<check if="{{ !empty(@GET.owner_id) && @GET.owner_id == @item.id }}">
										<true><option value="{{ @item.id }}" selected>{{ @item.name }}</option></true>
										<false><option value="{{ @item.id }}">{{ @item.name }}</option></false>
									</check>
								</repeat>
							</optgroup>
						</select>
					</td>
					<td>
						<select class="form-control input-sm" name="sprint_start_date">
							<option></option>
							<repeat group="{{ @sprints }}" value="{{ @item }}">
								<check if="{{ !empty(@GET.sprint_start_date) && @GET.sprint_start_date == @item.start_date }}">
									<true><option value="{{ @item.start_date }}" selected>{{ date("n/j/y", strtotime(@item.start_date)) }}</option></true>
									<false><option value="{{ @item.start_date }}">{{ date("n/j/y", strtotime(@item.start_date)) }}</option></false>
								</check>
							</repeat>
						</select>
					</td>
					<td></td>
					<td class="text-right">
						<noscript>
							<button type="submit" class="btn btn-xs btn-primary">{{ @dict.submit }}</button>
						</noscript>
					</td>
				</tr>
			</check>
			<check if="{{ !empty(@headings) }}">
				<tr>
					<th></th>
					<repeat group="{{ @headings }}" value="{{ @heading }}">
						<th class="nowrap"><a href="#" class="issue-sort nolink" id="{{ @heading }}">
							<check if="{{ !empty(@GET.orderby) && @GET.orderby == @heading }}">
								<true>
									<check if="{{ !empty(@GET.ascdesc) && @GET.ascdesc == 'asc' }}">
										<true><span class="glyphicon glyphicon-chevron-up"></span></true>
										<false><span class="glyphicon glyphicon-chevron-down"></span></false>
									</check>
								</true>
							</check>
							{{ !empty(@dict.cols[@heading]) ? @dict.cols[@heading] : ucwords(str_replace(array('_', 'id'), array(' ', 'ID'), @heading)) }}
						</a></th>
					</repeat>
				</tr>
			</check>
			</form>
		</thead>
		<tbody>
			<repeat group="{{ @issues.subset }}" value="{{ @item }}">
				<tr data-id="{{ @item.id }}" class="{{ @item.status_closed ? 'closed' : '' }}">
					<td><input type="checkbox" name="id[]" value="{{ @item.id }}"></td>
					<td><a href="issues/{{ @item.id }}">{{ @item.id }}</a></td>
					<td><a href="issues/{{ @item.id }}">{{ @item.name }}</a></td>
					<td>{{ @item.type_name }}</td>
					<td>{{ @item.priority_name }}</td>
					<td>{{ @item.status_name }}</td>
					<check if="{{ @item.author_username }}">
						<true>
							<td><a href="user/{{ @item.author_username }}" rel="author">{{ @item.author_name }}</a></td>
						</true>
						<false>
							<td>{{ @item.author_name }}</td>
						</false>
					</check>
					<check if="{{ @item.owner_username }}">
						<true>
							<td><a href="user/{{ @item.owner_username }}">{{ @item.owner_name }}</a></td>
						</true>
						<false>
							<td>{{ @item.owner_name }}</td>
						</false>
					</check>
					<td>{{ !empty(@item.sprint_start_date) ? date("n/j/y", strtotime(@item.sprint_start_date)) : "" }}</td>
					<td>{{ date("n/j/y", strtotime(@item.created_date)) }}</td>
					<td>{{ !empty(@item.due_date) ? date("n/j/y", strtotime(@item.due_date)) : "" }}</td>
				</tr>
			</repeat>
		</tbody>

	</table>
</form>

<check if="{{ isset(@statuses) }}">
<a class="btn btn-default btn-sm" data-toggle="modal" href="javascript:void(0)" data-target="#bulk-actions">{{ @dict.bulk_actions }}</a>
<div class="contatiner modal fade in" id="bulk-actions">
<form action="issues/bulk_update" method="post" id="bulk-form">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">{{ @dict.close }}</span></button>
				<h4 class="modal-title">{{ @dict.bulk_update }}</h4>
			</div>
			<div class="modal-body">
				<div class="form-group">
					<div class="row">
						<label class="col-xs-3 control-label label-sm">{{ @dict.cols.status }}</label>
						<div class="col-xs-9">
							<select class="form-control input-sm bulk-input" name="status">
								<option value="">{{ @dict.choose_option }}</option>
								<repeat group="{{ @statuses }}" value="{{ @item }}">
									<option value="{{ @item.id }}" >{{ @item.name }}</option>
								</repeat>
							</select>
						</div>

					</div>
				</div>
				<div class="form-group">
					<div class="row">

						<label class="col-xs-3 control-label label-sm">{{ @dict.cols.assignee }}</label>
						<div class="col-xs-9">
							<select class="form-control input-sm bulk-input" name="owner_id">
								<option value="">{{ @dict.choose_option }}</option>

								<optgroup label="Groups">
									<repeat group="{{ @groups }}" value="{{ @group }}">
										<option value="{{ @group.id }}">{{ @group.name }}</option>
									</repeat>
								</optgroup>
								<optgroup label="Users">
									<repeat group="{{ @users }}" value="{{ @item }}">
										<option value="{{ @item.id }}">{{ @item.name }}</option>
									</repeat>
								</optgroup>
							</select>
						</div>
					</div>
				</div>
				<div class="form-group">
					<div class="row">
						<label class="col-xs-3 control-label label-sm">{{ @dict.cols.due_date }}</label>
						<div class="col-xs-9">
							<input class="form-control input-sm bulk-input" id="due_date" type="text" name="due_date"  value="">
						</div>
					</div>
				</div>
				<div class="form-group">
					<div class="row">
						<label class="col-xs-3 control-label label-sm">{{ @dict.cols.parent_id }}</label>
						<div class="col-xs-9">
							<input class="form-control input-sm bulk-input" type="text" name="parent_id" value="">
						</div>
					</div>
				</div>
				<div class="form-group">
					<div class="row">
						<label class="col-xs-3 control-label label-sm">{{ @dict.cols.priority }}</label>
						<div class="col-xs-9">
							<select class="form-control input-sm bulk-input" name="priority">
								<option value="">{{ @dict.choose_option }}</option>
								<repeat group="{{ @priorities }}" value="{{ @item }}">
									<option value="{{ @item.value }}">{{ @item.name }}</option>
								</repeat>
							</select>
						</div>
					</div>
				</div>
				<div class="form-group">
					<div class="row">
						<label class="col-xs-3 control-label label-sm">{{ @dict.cols.sprint }}</label>
						<div class="col-xs-9">
							<select class="form-control input-sm bulk-input" name="sprint_id">
								<option value="">{{ @dict.choose_option }}</option>
								<repeat group="{{ @sprints }}" value="{{ @item }}">
									<option value="{{ @item.id }}" >{{ @item.name }} {{ date('n/j', strtotime(@item.start_date)) }}-{{ date('n/j', strtotime(@item.end_date)) }}</option>
								</repeat>
							</select>
						</div>
					</div>
				</div>
				<div class="form-group">
					<div class="row">
						<label class="col-xs-3 control-label label-sm">{{ @dict.cols.type }}</label>
						<div class="col-xs-9">
							<select class="form-control input-sm bulk-input" name="type_id">
								<option value="">{{ @dict.choose_option }}</option>
								<repeat group="{{ @issue_types }}" value="{{ @item }}">
									<option value="{{ @item.id }}">{{ @item.name }}</option>
								</repeat>
							</select>
						</div>
					</div>
				</div>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-sm btn-default" data-dismiss="modal">{{ @dict.cancel }}</button>
				<button type="submit" id="bulk-submit" class="btn btn-sm btn-primary">{{ @dict.submit }}</button>
			</div>
		</div>
	</div>
	<input type="hidden" id="url_query" name="url_query" value="{{ http_build_query($_GET) }}" />
	<input type="hidden" id="url_path" name="url_path" value="{{ @PATH }}" />
</form>
</div>
</check>
